<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª°ã‹ã®ãƒ–ãƒ­ã‚°å…¥å£</title>
    <link rel="stylesheet" href="/assets/style.css">
</head>
<body>

    <header>
        <div class="header-content">
            <a class="logo-link">
                <img src="/assets/cloudblog_logo.png" alt="CLOUDBLOGãƒ­ã‚´" class="header-logo">
            </a>
        </div>
    </header>

    <div class="main-container">
        <div class="page-title-area">
    <h1>èª°ã‹ã®ãƒ–ãƒ­ã‚°</h1>
    <p>ã“ã‚“ã«ã¡ã¯ã€‚åˆ¥ã®ONCEã®ãƒ–ãƒ­ã‚°ã§ã™ã€‚</p>
</div>
<div class="top-link-area">
    
    <a href="/hokanoblog/public/" class="main-button public-link">
        å…¬é–‹è¨˜äº‹
    </a>
    
    <a href="/hokanoblog/private/" class="main-button private-link">
        ğŸ”’ éå…¬é–‹è¨˜äº‹
    </a>
</div>
    </div>

    <footer>
        <p class="footer-note">
            ã“ã®Webã‚µã‚¤ãƒˆã®å†…å®¹ã¯ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€<br>
            å®Ÿåœ¨ã®äººç‰©ãƒ»å›£ä½“ã¨ã¯ä¸€åˆ‡é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚
        </p>
        <p class="footer-copyright">&copy; 2025 å‡ºé›²ï¼ˆ@pearl_izumoï¼‰</p>
    </footer>

    <script>
        // ğŸ”‘ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å®šç¾©: Liquidå¤‰æ•°ã®å®‰å…¨ãªå‚ç…§
        const BASE_URL = ""; 
        const CURRENT_BLOG_PATH = "xxxblog"; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚‚è¨­å®š
        //window.CURRENT_BLOG_PATH = "amaneblog";
        const PRIVATE_PATH = BASE_URL + "/" + CURRENT_BLOG_PATH + "/private/";
        console.log(PRIVATE_PATH);
        const AUTH_FLAG_KEY = `isAuthenticated_${CURRENT_BLOG_PATH}`;

        const AUTH_SETTINGS = {
            'amaneblog': {
                // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æƒ…å ±
                password1: "MTk5NzAzMjQ=",
                password2: "ZmVlbHNwZWNpYWw=",
                // è³ªå•æƒ…å ±
                question1: 'ãƒ»ç§ã®æ¨ã—ã®èª•ç”Ÿæ—¥ã¯ï¼Ÿ',
                placeholder1: 'è¥¿æš¦ã‚ã‚Š8æ¡',
                inputType1: 'text',
                question2: 'ãƒ»ç§ã®æ€ã„å‡ºã®æ›²ã¯ï¼Ÿ',
                placeholder2: 'è‹±èªå°æ–‡å­—',
                inputType2: 'text',
            },
            'hokanoblog': {
                // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æƒ…å ±
                password1: "1st",
                password2: "2nd",
                // è³ªå•æƒ…å ±
                question1: 'ãƒ»ç§ã®èª•ç”Ÿæ—¥ã¯ï¼Ÿ',
                placeholder1: 'æ¼¢å­—3æ–‡å­—',
                inputType1: 'number',
                question2: 'ãƒ»ç§˜å¯†ã®åˆè¨€è‘‰ã¯ï¼Ÿ',
                placeholder2: 'å…¨ã¦å¤§æ–‡å­—',
                inputType2: 'text', 
            },
            'default': {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæƒ…å ± (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨è³ªå•)
                password1: "DEFAULT_1",
                password2: "DEFAULT_2",
                question1: 'ãƒ»èªè¨¼ã‚³ãƒ¼ãƒ‰ 1/2',
                placeholder1: 'ã‚³ãƒ¼ãƒ‰1ã‚’å…¥åŠ›',
                inputType1: 'text',
                question2: 'ãƒ»èªè¨¼ã‚³ãƒ¼ãƒ‰ 2/2',
                placeholder2: 'ã‚³ãƒ¼ãƒ‰2ã‚’å…¥åŠ›',
                inputType2: 'text',
            }
        };

        // 1. èªè¨¼ã«å¿…è¦ãªè¨­å®šã‚’ç¾åœ¨ã®ãƒ–ãƒ­ã‚°ãƒ‘ã‚¹ã‹ã‚‰å–å¾—
        const currentSettings = AUTH_SETTINGS[CURRENT_BLOG_PATH] || AUTH_SETTINGS.default;

        // 2. èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã§ä½¿ç”¨ã™ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä»£å…¥
        const CORRECT_PASSWORD_1 = currentSettings.password1; 
        const CORRECT_PASSWORD_2 = currentSettings.password2;

        // 1. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼IDã®ç”Ÿæˆã¨æ°¸ç¶šåŒ– (ã‚³ãƒ¡ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼ç”¨)
        function getPlayerId() {
            let playerId = localStorage.getItem('arg_player_id');
            if (!playerId) {
                playerId = 'player-' + Math.random().toString(36).substring(2, 9);
                localStorage.setItem('arg_player_id', playerId);
            }
            return playerId;
        }

        getPlayerId(); 

        // é›£èª­åŒ–
        function decodeBase64(encodedString) {
            // JavaScriptæ¨™æº–ã®atobé–¢æ•°ã‚’ä½¿ç”¨
            return atob(encodedString); 
        }


        // 2. æ±ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ (2æ®µéšèªè¨¼)
        function authenticate() {
            document.body.classList.add('is-locked');
            // ãƒ•ã‚©ãƒ¼ãƒ ã®HTMLã‚’å®šç¾©
            const formHtml = `
                <div id="auth-overlay" style="display: flex;">
                    <div id="auth-container">
                        <h2>éå…¬é–‹ã‚¨ãƒªã‚¢</h2>
                        
                        <form id="password-form" onsubmit="handleAuthSubmit(event)">
                            <p>${currentSettings.question1}</p>
                            <input type="${currentSettings.inputType1}" id="auth-input-1" placeholder="--${currentSettings.placeholder1}" required>
                            <br>
                            <p>${currentSettings.question2}</p>
                            <input type="${currentSettings.inputType2}" id="auth-input-2" placeholder="--${currentSettings.placeholder2}" required>
                            
                            <button type="submit" id="auth-submit-button">ãƒ­ã‚°ã‚¤ãƒ³</button>
                        </form>
                        
                        <p id="auth-message" style="display: none;">å›ç­”ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚</p>
                        
                        <p style="margin-top: 20px; text-align: center;"><a href="${BASE_URL}/${CURRENT_BLOG_PATH}" style="color: var(--color-link);"> << ãƒ–ãƒ­ã‚°TOP</a></p>
                    </div>
                </div>
            `;

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ body ã®å…ˆé ­ã«æŒ¿å…¥ (afterbegin)
            const headerElement = document.querySelector('header');
            if (headerElement) {
                headerElement.insertAdjacentHTML('afterend', formHtml);
            } else {
                // header ãŒè¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã° body ã®å…ˆé ­ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                document.body.insertAdjacentHTML('afterbegin', formHtml);
            }
            
            // ã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã™ã‚‹ãŸã‚ã€è¦ç´ ãŒå­˜åœ¨ã™ã‚‹å ´åˆã«ã®ã¿ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’è©¦ã¿ã¾ã™
            const input1 = document.getElementById('auth-input-1');
            if (input1) {
                input1.focus(); 
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®å‡¦ç†
        function handleAuthSubmit(event) {
            event.preventDefault(); 
            
            const input1 = document.getElementById('auth-input-1').value.trim();
            const input2 = document.getElementById('auth-input-2').value.trim();
            const errorMessage = document.getElementById('auth-message');

            const decodedPassword1 = decodeBase64(CORRECT_PASSWORD_1);
            const decodedPassword2 = decodeBase64(CORRECT_PASSWORD_2);

            if (input1 === decodedPassword1 && input2 === decodedPassword2) {
                // èªè¨¼æˆåŠŸ
                document.body.classList.remove('is-locked');
                localStorage.setItem(AUTH_FLAG_KEY, 'true');
                const overlay = document.getElementById('auth-overlay');
                if (overlay) { overlay.remove(); }
                
                
                window.location.href = window.location.href; 
            } else {
                // èªè¨¼å¤±æ•—
                errorMessage.style.display = 'block';
                document.getElementById('auth-input-1').value = ''; 
                document.getElementById('auth-input-2').value = ''; 
                document.getElementById('auth-input-1').focus();
            }
        }

        // 3. ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Ÿè¡Œ
        function checkPrivateAccess() {
            const currentPath = window.location.pathname;
            
            // ğŸ”‘ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° PRIVATE_PATH ã‚’ä½¿ç”¨
            const isAuthenticated = localStorage.getItem(AUTH_FLAG_KEY) === 'true';
            const isPrivateArea = currentPath.startsWith(PRIVATE_PATH); 


            // éå…¬é–‹ã‚¨ãƒªã‚¢ã‹ã¤æœªèªè¨¼ã®å ´åˆ
            if (isPrivateArea && !isAuthenticated) {
                
                authenticate(); // ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
                const mainContent = document.querySelector('.main-container');
                
            } else {
                // èªè¨¼æ¸ˆã¿ã¾ãŸã¯å…¬é–‹ã‚¨ãƒªã‚¢ã®å ´åˆ
                document.body.style.display = 'block'; 
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œ
        checkPrivateAccess();

    </script>

</body>
</html>