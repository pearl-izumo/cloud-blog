<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>非公開記事一覧 (要認証)</title>
    <link rel="stylesheet" href="/assets/style.css">
</head>
<body>

    <header>
        <div class="header-content">
            <a href="/" class="logo-link">
                <img src="/assets/cloudblog_logo.png" alt="CLOUDBLOGロゴ" class="header-logo">
            </a>
        </div>
    </header>

    <div class="main-container">
        <h2>【非公開エリア】アクセス認証済み</h2>

<p>認証されたプレイヤーのみが閲覧できる記録のリストです。ここには、システムによって隠されている機密性の高いログが含まれる場合があります。</p>

<div id="posts-list-container">
    
    <div class="posts-list">
    <h1>非公開記事一覧 (要認証)</h1>
    
    
    
    
    

    
     

    <ul>
        
            
            
            

            
            

            
            
            

            
            
        
            
            
            

            
            

            
            
            

            
            
        
            
            
            

            
            

            
            
            

            
            
        
            
            
            

            
            

            
            
            

            
            
        
            
            
            

            
            

            
            
            

            
            <li>
                <a href="/hokanoblog/private/2025/10/12/trigger-test">
                    コメントトリガー記事 - 独白
                </a>
                <small>(2025-10-12)</small>
            </li>
            
            
        
            
            
            

            
            
                
    </ul>
    
    
        <p>※このリストは認証済みユーザーのみに表示されます。</p>
    
</div>



</div>

<script>
    // 🔑 ローカルストレージキーの定義
    const LIST_FLAG_KEY = 'arg_flag_state'; 
    const LIST_CURRENT_STATE = localStorage.getItem(LIST_FLAG_KEY);
    const LIST_BASE_URL = ""; 
    
    // 🔑 隠し記事の情報を定義 (Liquid変数とは異なるJS変数として定義)
    const HIDDEN_POST_URL = LIST_BASE_URL + '/private/2025/10/13/system-response-log.html';
    const HIDDEN_POST_TITLE = "[システムログ] 記録処理結果の報告";
    const HIDDEN_POST_DATE = "2025/10/13"; 

    function checkAndDisplayHiddenPost() {
        // 🔑 修正の核: 状態が COMPLETED の場合のみ、処理を実行
        if (LIST_CURRENT_STATE === 'COMPLETED') { 
            
            // 既存のリスト（<ul>）要素を見つける
            // Liquidが生成したリストの親要素（.posts-list）内の <ul> タグを探す
            let targetList = document.querySelector('.posts-list ul');
            
            if (!targetList) {
                // 挿入対象のリストが見つからなければ処理を終了
                console.error("Target list (<ul>) not found for dynamic insertion.");
                return;
            }

            // 🔑 挿入するHTMLをこのブロック内で生成
            const hiddenPostHtml = `
                <li style="list-style: none; margin-bottom: 10px;">
                    <a href="${HIDDEN_POST_URL}" style="display: block; border: 2px solid green; padding: 10px; text-decoration: none; color: black; background-color: #f9fff9;">
                        <h3 style="margin-top: 0; margin-bottom: 5px; font-size: 1.1em; color: #1a5;">
                            ${HIDDEN_POST_TITLE}
                            <span style="font-size: 0.7em; margin-left: 10px; padding: 2px 6px; background: green; color: white; border-radius: 3px;">NEW LOG</span>
                        </h3>
                        <small style="color: #666;">()</small>
                    </a>
                </li>
            `;
            
            // 既存リストの先頭に挿入
            targetList.insertAdjacentHTML('afterbegin', hiddenPostHtml);
        }
        // COMPLETED でなければ、何も表示しない（Liquidによって元々隠されているため）
    }

    // ページロード時に実行
    document.addEventListener('DOMContentLoaded', checkAndDisplayHiddenPost);
</script>
    </div>

    <footer>
        <p class="footer-note">
            このWebサイトの内容はフィクションであり、<br>
            実在の人物・団体とは一切関係ありません。
        </p>
        <p class="footer-copyright">&copy; 出雲（@pearl_izumo）</p>
    </footer>

    <script>
        // 🔑 グローバル変数定義: Liquid変数の安全な参照
        const BASE_URL = ""; 
        const CURRENT_BLOG_PATH = "hokanoblog"; // デフォルト値も設定
        const PRIVATE_PATH = BASE_URL + "/" + CURRENT_BLOG_PATH + "/private/";
        
        // 2段階パスワードを取得 (デフォルト値で安全化)
        //const CORRECT_PASSWORD_1 = "AMANE-SECRET-KEY";
        //const CORRECT_PASSWORD_2 = "CLOUD-HIDDEN-WORD";
        const CORRECT_PASSWORD_1 = "1st";
        const CORRECT_PASSWORD_2 = "2nd";


        // 1. プレイヤーIDの生成と永続化 (コメントトリガー用)
        function getPlayerId() {
            let playerId = localStorage.getItem('arg_player_id');
            if (!playerId) {
                playerId = 'player-' + Math.random().toString(36).substring(2, 9);
                localStorage.setItem('arg_player_id', playerId);
            }
            return playerId;
        }

        getPlayerId(); 


        // 2. 汎用パスワード認証ロジック (2段階認証)
        function authenticate() {
            // フォームのHTMLを定義
            const formHtml = `
                <div id="auth-overlay" style="
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0, 0, 0, 0.9); z-index: 10000; 
                    display: flex; 
                    justify-content: center; align-items: center; 
                    flex-direction: column; color: white;
                ">
                    <h2>【二重認証が必要です】</h2>
                    <p>非公開エリアへ入るための **合言葉** と **秘密の数字** を入力してください。</p>
                    <form id="password-form" onsubmit="handleAuthSubmit(event)">
                        <input type="text" id="auth-input-1" placeholder="合言葉 (例: AMANE-SECRET-KEY)" style="padding: 8px; margin: 5px; width: 250px;">
                        <input type="text" id="auth-input-2" placeholder="秘密の数字 (例: CLOUD-HIDDEN-WORD)" style="padding: 8px; margin: 5px; width: 250px;">
                        <button type="submit" style="padding: 8px 15px; margin-top: 10px;">認証を試みる</button>
                    </form>
                    <p style="margin-top: 20px;"><a href="${BASE_URL}/" style="color: #ccc;">[ ブログ入口に戻る ]</a></p>
                    <p id="error-message" style="color: red; margin-top: 10px; display: none;">合言葉または秘密の数字が違います。</p>
                </div>
            `;

            // フォームを body の先頭に挿入 (afterbegin)
            document.body.insertAdjacentHTML('afterbegin', formHtml);
            
            // エラーを回避するため、要素が存在する場合にのみフォーカスを試みます
            const input1 = document.getElementById('auth-input-1');
            if (input1) {
                 input1.focus(); 
            }
        }

        // フォーム送信時の処理
        function handleAuthSubmit(event) {
            event.preventDefault(); 
            
            const input1 = document.getElementById('auth-input-1').value.trim();
            const input2 = document.getElementById('auth-input-2').value.trim();
            const errorMessage = document.getElementById('error-message');

            if (input1 === CORRECT_PASSWORD_1 && input2 === CORRECT_PASSWORD_2) {
                // 認証成功
                localStorage.setItem('isAuthenticated', 'true');
                const overlay = document.getElementById('auth-overlay');
                if (overlay) { overlay.remove(); }
                
                window.location.href = window.location.href; 
            } else {
                // 認証失敗
                errorMessage.style.display = 'block';
                document.getElementById('auth-input-1').value = ''; 
                document.getElementById('auth-input-2').value = ''; 
                document.getElementById('auth-input-1').focus();
            }
        }

        // 3. アクセス制御の実行
        function checkPrivateAccess() {
            const currentPath = window.location.pathname;
            
            // 🔑 グローバル変数 PRIVATE_PATH を使用
            const isPrivateArea = currentPath.startsWith(PRIVATE_PATH); 
            const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';

            // 非公開エリアかつ未認証の場合
            if (isPrivateArea && !isAuthenticated) {
                
                authenticate(); // フォームを表示

                // 修正済み: bodyの構成要素を個別に非表示にする
                document.body.style.display = 'block'; 
                
                const elementsToHide = ['header', '.container', 'footer'];
                elementsToHide.forEach(selector => {
                    const element = document.querySelector(selector);
                    if (element) {
                        element.style.display = 'none';
                    }
                });
                
            } else {
                // 認証済みまたは公開エリアの場合
                document.body.style.display = 'block'; 
            }
        }

        // ページロード時に実行
        checkPrivateAccess();

    </script>

</body>
</html>