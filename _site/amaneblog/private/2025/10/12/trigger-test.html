<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚³ãƒ¡ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼è¨˜äº‹ - ç‹¬ç™½</title>
    <link rel="stylesheet" href="/assets/style.css">
</head>
<body>

    <header>
        <div class="header-content">
            <a class="logo-link">
                <img src="/assets/cloudblog_logo.png" alt="CLOUDBLOGãƒ­ã‚´" class="header-logo">
            </a>
        </div>
    </header>

    <div class="main-container">
        <article>
    <div id="notification-container"></div>
    <h1>ã‚³ãƒ¡ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼è¨˜äº‹ - ç‹¬ç™½</h1>

    

    

    

    
        <p>æŠ•ç¨¿æ—¥: 2025å¹´10æœˆ12æ—¥</p>
    

    <div class="post-content">
        <p>ã“ã®è¨˜äº‹ã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹ã¨ã€ã‚¢ãƒãƒã‹ã‚‰ã®åå¿œãŒæ™‚é–“å·®ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>

<p>ã€æ³¨æ„ã€‘ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚³ãƒ¡ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼ã®JavaScriptãƒ­ã‚¸ãƒƒã‚¯ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚</p>

    </div>

    <!-- <hr style="margin-top: 40px;"> -->
    
    <section id="comment-section">
        <h2>ã‚³ãƒ¡ãƒ³ãƒˆ</h2>

        

        <div id="comment-form-area">
            <p>ã‚·ã‚¹ãƒ†ãƒ ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
        
        <div id="comment-history-area">
            <p style="color: #666;"></p>
        </div>

    </section>

    <div class="return-links-area">
        
        
        
        

        
            <a href="/amaneblog/private/index.html" class="return-link">éå…¬é–‹è¨˜äº‹ä¸€è¦§ã«æˆ»ã‚‹ &raquo;</a>
        
    </div>

</article>

<script>
    //const CURRENT_BLOG_PATH = "";
    const BLOG_PATH = "amaneblog"; // å®‰å…¨ã®ãŸã‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å†è¨­å®š
    const CURRENT_PLAYER_ID = localStorage.getItem('arg_player_id') || 'unknown';
    const CURRENT_POST_SLUG = "trigger-test";
    const ENABLE_COMMENT_TRIGGER = "true" === 'true';

    const QUOTE_SLUG = "";
    const QUOTED_COMMENT_KEY = `comment_content_${BLOG_PATH}_${QUOTE_SLUG}`;

    // ã‚­ãƒ¼ã«ãƒ–ãƒ­ã‚°IDã¨ã‚¹ãƒ©ãƒƒã‚°ã‚’å«ã‚ã‚‹ã“ã¨ã§ã€è¨˜äº‹ã”ã¨ã«çŠ¶æ…‹ã‚’åˆ†é›¢
    // ä¾‹: 'trigger_state_amaneblog_trigger-test'
    const FLAG_STATE_KEY = `trigger_state_${BLOG_PATH}_${CURRENT_POST_SLUG}`;
    // ä¾‹: 'comment_content_amaneblog_trigger-test'
    const COMMENT_CONTENT_KEY = `comment_content_${BLOG_PATH}_${CURRENT_POST_SLUG}`; 
    // ä¾‹: 'trigger_time_ms_amaneblog_trigger-test'
    const TRIGGER_TIME_MS_KEY = `trigger_time_ms_${BLOG_PATH}_${CURRENT_POST_SLUG}`;
    // æ—¥ä»˜ä¿å­˜ç”¨ã®ã‚­ãƒ¼ã‚’å®šç¾©
    const TRIGGER_DATE_KEY = `trigger_date_${BLOG_PATH}_${CURRENT_POST_SLUG}`;

    // ğŸ”‘ éš ã—è¨˜äº‹ã®ã‚¹ãƒ©ãƒƒã‚°åˆ¤å®šç”¨
    const HIDDEN_POST_SLUGS = ["system-response-log"]; // å˜ä¸€ã®ã‚¹ãƒ©ãƒƒã‚°ã«é™å®š
    const IS_HIDDEN_POST = HIDDEN_POST_SLUGS.includes(CURRENT_POST_SLUG);

    // ---------------------------------------------------
    // ğŸ”‘ ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆã¨è¡¨ç¤º
    // ---------------------------------------------------
    
    function renderCommentForm() {
        const formArea = document.getElementById('comment-form-area');
        
        // 1. ãƒˆãƒªã‚¬ãƒ¼ãŒç„¡åŠ¹ãªè¨˜äº‹ã§ã¯ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã—ãªã„
        if (!ENABLE_COMMENT_TRIGGER) {
            formArea.innerHTML = '<p style="color: #888; text-align:center;">ã“ã®è¨˜äº‹ã§ã¯ç¾åœ¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å—ã‘ä»˜ã‘ã¦ã„ã¾ã›ã‚“ã€‚</p>';
            return;
        }

        const currentState = localStorage.getItem(FLAG_STATE_KEY);

        if (currentState === 'COMPLETED') {
            // 2. å®Œäº†å¾Œã®è¡¨ç¤º: æ–°ã—ã„è¨˜äº‹ãŒè¡¨ç¤ºã•ã‚ŒãŸã“ã¨ã‚’ç¤ºå”†
            formArea.innerHTML = '<p style="display: none;" id="timer-status"></p> ';
        } else if (currentState === 'PENDING') {
            // 3. å‡¦ç†ä¸­ã®è¡¨ç¤º: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã€ä½•ã‚‚è¡¨ç¤ºã—ãªã„
            formArea.innerHTML = `
                <p style="display: none;" id="timer-status"></p> 
            `;
            // è£ã§ã‚¿ã‚¤ãƒãƒ¼ç›£è¦–è‡ªä½“ã¯ç¶™ç¶šã•ã›ã‚‹ï¼ˆé‡è¦ï¼‰
            checkTriggerStatus(); 
        } else {
            // 4. åˆæœŸçŠ¶æ…‹: ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
            const formHtml = `
            <div id="comment-form-container" class="comment-entry-box"> 
        
                <p class="comment-meta"><strong>[ æŠ•ç¨¿è€…: åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼]</strong></p>
                
                <form id="comment-form" onsubmit="handleCommentSubmit(event)">
                    
                    <textarea id="comment-text" name="comment" rows="3" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜å…¥ï¼ˆ50æ–‡å­—ä»¥å†…ï¼‰" maxlength="50"></textarea>
                    <div class="button-container">
                        <button type="submit" id="comment-submit-button">ã‚³ãƒ¡ãƒ³ãƒˆã‚’é€ä¿¡</button>
                        
                        <p id="comment-message" class="comment-status-message" style="display: none; text-align: center;"></p>
                    </div>
                </form>
            </div>
            `;
            formArea.innerHTML = formHtml;
        }
    }

    // ---------------------------------------------------
    // ğŸ”‘ ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç† (ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è¨˜éŒ²)
    // ---------------------------------------------------
    
    function handleCommentSubmit(event) {
        event.preventDefault(); 
        
        const commentText = document.getElementById('comment-text').value.trim();
        const messageElement = document.getElementById('comment-message');
        
        if (commentText.length === 0) {
            messageElement.textContent = "ã‚³ãƒ¡ãƒ³ãƒˆãŒè¨˜å…¥ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
            messageElement.style.color = 'red';
            messageElement.style.display = 'block';
            return;
        }

        // 1. å‡¦ç†å®Œäº†æ™‚åˆ»ã‚’è¨­å®š (ç¾åœ¨æ™‚åˆ» + 60ç§’)
        const ONE_MINUTE_MS = 60 * 1000;
        const triggerTime = Date.now() + ONE_MINUTE_MS; 
        
        // 2. Local Storageã«çŠ¶æ…‹ã‚’è¨˜éŒ²
        localStorage.setItem(FLAG_STATE_KEY, 'PENDING');
        localStorage.setItem(COMMENT_CONTENT_KEY, commentText);
        localStorage.setItem(TRIGGER_TIME_MS_KEY, triggerTime.toString());
        showNotification("ã‚³ãƒ¡ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚");

        if (!localStorage.getItem(TRIGGER_DATE_KEY)) {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const dateToSave = `${year}-${month}-${day}`;
            
            localStorage.setItem(TRIGGER_DATE_KEY, dateToSave);
        }
        
        // 3. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨ãƒªãƒ­ãƒ¼ãƒ‰
        messageElement.textContent = "";
        // messageElement.style.color = 'green';
        messageElement.style.display = 'block';
        
        // ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºã‚’æ›´æ–°ã—ã€PENDINGçŠ¶æ…‹ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’è¡¨ç¤ºã•ã›ã‚‹
        setTimeout(() => {
            window.location.href = window.location.href; 
        }, 1500);
    }
    
    // ---------------------------------------------------
    // ğŸ”‘ ã‚¿ã‚¤ãƒãƒ¼ç›£è¦–ãƒ­ã‚¸ãƒƒã‚¯ (å®Œäº†ãƒã‚§ãƒƒã‚¯)
    // ---------------------------------------------------
    
    function checkTriggerStatus() {
        const statusElement = document.getElementById('timer-status');
        const currentState = localStorage.getItem(FLAG_STATE_KEY);
        const triggerTime = parseInt(localStorage.getItem(TRIGGER_TIME_MS_KEY), 10);

        if (currentState !== 'PENDING' || !triggerTime) {
            return;
        }

        console.log("--- Trigger System: PENDING ---");
        
        const updateTimer = () => {
            const now = Date.now();
            const remainingMs = triggerTime - now;

            if (remainingMs <= 0) {
                // å®Œäº†ï¼çŠ¶æ…‹ã‚’COMPLETEDã«æ›´æ–°ã—ã€ãƒªãƒ­ãƒ¼ãƒ‰
                localStorage.setItem(FLAG_STATE_KEY, 'COMPLETED');
                clearInterval(timerInterval);
                console.log("--- Trigger System: COMPLETED. Reloading... ---");
                window.location.reload();
                return;
            }

            // æ®‹ã‚Šæ™‚é–“ã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
            const remainingSeconds = Math.ceil(remainingMs / 1000);
            console.log(`Remaining time: ${remainingSeconds} seconds.`);
        };

        // 1ç§’ã”ã¨ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’æ›´æ–°
        const timerInterval = setInterval(updateTimer, 10000);
        updateTimer(); // å³åº§ã«å®Ÿè¡Œ
    }


    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    document.addEventListener('DOMContentLoaded', renderCommentForm);

    // ---------------------------------------------------
    // ğŸ”‘ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¼•ç”¨å‡¦ç†
    // ---------------------------------------------------

    function quoteCommentContent() {
        // å¼•ç”¨ã—ãŸã„è¦ç´ ã‚’å–å¾—
        const quoteElement = document.getElementById('quoted-comment-content');
        
        // ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹ã‚’å–å¾—
        const savedComment = localStorage.getItem(QUOTED_COMMENT_KEY);

        if (quoteElement && savedComment) {
            // è¦ç´ ãŒã‚ã‚Œã°ã€localStorageã®ã‚³ãƒ¡ãƒ³ãƒˆã§å†…å®¹ã‚’ç½®ãæ›ãˆã‚‹
            quoteElement.textContent = savedComment;
        }
    }

    // ---------------------------------------------------
    // ğŸ”‘ ã‚³ãƒ¡ãƒ³ãƒˆå±¥æ­´è¡¨ç¤ºå‡¦ç†
    // ---------------------------------------------------

    function renderCommentHistory() {
        const historyContainer = document.getElementById('comment-history-area');
        const savedHistory = localStorage.getItem(COMMENT_CONTENT_KEY);
        const commentDateKey = `trigger_date_${BLOG_PATH}_${CURRENT_POST_SLUG}`;

        // å±¥æ­´ãŒä¿å­˜ã•ã‚Œã¦ã„ãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„
        if (!historyContainer || !savedHistory) {
            return;
        }
        
        // å±¥æ­´HTMLã‚’ç”Ÿæˆ
        const historyHtml = `
            <div style="margin-top: 20px; padding: 10px;">
                <div style="border-left: 3px solid #ccc; padding-left: 10px; margin-bottom: 10px;">
                    <p style="margin: 0;"><strong>1:åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼</strong>
                    <p style="margin: 0;">æŠ•ç¨¿æ—¥ï¼š${localStorage.getItem(commentDateKey)}</p>
                    <p style="white-space: pre-wrap; margin: 5px 0 0 0;">${savedHistory}</p>
                </div>
            </div>
        `;
        
        historyContainer.innerHTML = historyHtml;
    }

    // ---------------------------------------------------
    // ğŸ”‘ é€šçŸ¥ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºå‡¦ç†
    // ---------------------------------------------------
    function showNotification(message) {
        const container = document.getElementById('notification-container');
        if (!container) return;

        // 1. é€šçŸ¥è¦ç´ ã®ç”Ÿæˆ
        const notification = document.createElement('div');
        notification.className = 'toast-notification';
        notification.textContent = message;

        // 2. ã‚³ãƒ³ãƒ†ãƒŠã«è¿½åŠ 
        container.appendChild(notification);
        
        // 3. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: ã‚ãšã‹ã«é…å»¶ã•ã›ã¦ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã—ã€ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³ã•ã›ã‚‹
        setTimeout(() => {
            notification.classList.add('show');
        }, 10); 

        // 4. è‡ªå‹•ã§æ¶ˆå»: 3ç§’å¾Œã«ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆã—ã€DOMã‹ã‚‰å‰Šé™¤ã™ã‚‹
        setTimeout(() => {
            notification.classList.remove('show'); // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆé–‹å§‹
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†å¾Œï¼ˆ0.5ç§’å¾Œï¼‰ã«è¦ç´ ã‚’DOMã‹ã‚‰å‰Šé™¤
            setTimeout(() => {
                notification.remove(); 
            }, 500); 
            
        }, 3000); // 3ç§’é–“è¡¨ç¤º
    }

    // ğŸ¯ ä¿®æ­£ç®‡æ‰€ 2: å¼•ç”¨å…ƒã®ãƒˆãƒªã‚¬ãƒ¼è¨˜äº‹ã®æ—¥ä»˜ã‚­ãƒ¼ã‚’å†æ§‹ç¯‰
    const QUOTE_DATE_KEY = `trigger_date_${BLOG_PATH}_${QUOTE_SLUG}`;

    function getDisplayDate() {
        // éš ã—è¨˜äº‹ã®å ´åˆã¯ã€ãƒˆãƒªã‚¬ãƒ¼è¨˜äº‹ã®æ—¥ä»˜ã‚’ãƒã‚§ãƒƒã‚¯
        if (IS_HIDDEN_POST && QUOTE_SLUG) {
            const savedDate = localStorage.getItem(QUOTE_DATE_KEY);
            // ä¿å­˜ã•ã‚Œã¦ã„ã‚Œã°ãã®æ—¥ä»˜ã‚’è¿”ã—ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’è¿”ã™
            return savedDate || '---'; 
        }
        return ''; // ééš ã—è¨˜äº‹ã®å ´åˆã¯æ—¥ä»˜è¡¨ç¤ºå‡¦ç†ã‚’è¡Œã‚ãªã„
    }

    function renderDynamicDate() {
        // éš ã—è¨˜äº‹ã®å ´åˆã®ã¿å®Ÿè¡Œ
        if (!IS_HIDDEN_POST) {
            return; 
        }
        const dateElement = document.getElementById('dynamic-post-date');
        const displayDate = getDisplayDate();

        if (dateElement) {
            //æ°¸ç¶šåŒ–ã•ã‚ŒãŸæ—¥ä»˜ã‚’è¡¨ç¤º
            dateElement.textContent = `${displayDate}`;
        }
    }

    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«è¿½åŠ 
    document.addEventListener('DOMContentLoaded', renderCommentForm);
    document.addEventListener('DOMContentLoaded', quoteCommentContent);
    document.addEventListener('DOMContentLoaded', renderCommentHistory);
    document.addEventListener('DOMContentLoaded', renderDynamicDate);// ğŸ‘ˆ ã“ã®è¡Œã‚’è¿½åŠ 

</script>
    </div>

    <footer>
        <p class="footer-note">
            ã“ã®Webã‚µã‚¤ãƒˆã®å†…å®¹ã¯ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€<br>
            å®Ÿåœ¨ã®äººç‰©ãƒ»å›£ä½“ã¨ã¯ä¸€åˆ‡é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚
        </p>
        <p class="footer-copyright">&copy; 2025 å‡ºé›²ï¼ˆ@pearl_izumoï¼‰</p>
    </footer>

    <script>
        // ğŸ”‘ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å®šç¾©: Liquidå¤‰æ•°ã®å®‰å…¨ãªå‚ç…§
        const BASE_URL = ""; 
        const CURRENT_BLOG_PATH = "amaneblog"; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚‚è¨­å®š
        //window.CURRENT_BLOG_PATH = "amaneblog";
        const PRIVATE_PATH = BASE_URL + "/" + CURRENT_BLOG_PATH + "/private/";
        console.log(PRIVATE_PATH);
        const AUTH_FLAG_KEY = `isAuthenticated_${CURRENT_BLOG_PATH}`;

        const AUTH_SETTINGS = {
            'amaneblog': {
                // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æƒ…å ±
                password1: "MTk5NzAzMjQ=",
                password2: "ZmVlbHNwZWNpYWw=",
                // è³ªå•æƒ…å ±
                question1: 'ãƒ»ç§ã®æ¨ã—ã®èª•ç”Ÿæ—¥ã¯ï¼Ÿ',
                placeholder1: 'è¥¿æš¦ã‚ã‚Š8æ¡',
                inputType1: 'text',
                question2: 'ãƒ»ç§ã®æ€ã„å‡ºã®æ›²ã¯ï¼Ÿ',
                placeholder2: 'è‹±èªå°æ–‡å­—',
                inputType2: 'text',
            },
            'hokanoblog': {
                // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æƒ…å ±
                password1: "1st",
                password2: "2nd",
                // è³ªå•æƒ…å ±
                question1: 'ãƒ»ç§ã®èª•ç”Ÿæ—¥ã¯ï¼Ÿ',
                placeholder1: 'æ¼¢å­—3æ–‡å­—',
                inputType1: 'number',
                question2: 'ãƒ»ç§˜å¯†ã®åˆè¨€è‘‰ã¯ï¼Ÿ',
                placeholder2: 'å…¨ã¦å¤§æ–‡å­—',
                inputType2: 'text', 
            },
            'default': {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæƒ…å ± (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨è³ªå•)
                password1: "DEFAULT_1",
                password2: "DEFAULT_2",
                question1: 'ãƒ»èªè¨¼ã‚³ãƒ¼ãƒ‰ 1/2',
                placeholder1: 'ã‚³ãƒ¼ãƒ‰1ã‚’å…¥åŠ›',
                inputType1: 'text',
                question2: 'ãƒ»èªè¨¼ã‚³ãƒ¼ãƒ‰ 2/2',
                placeholder2: 'ã‚³ãƒ¼ãƒ‰2ã‚’å…¥åŠ›',
                inputType2: 'text',
            }
        };

        // 1. èªè¨¼ã«å¿…è¦ãªè¨­å®šã‚’ç¾åœ¨ã®ãƒ–ãƒ­ã‚°ãƒ‘ã‚¹ã‹ã‚‰å–å¾—
        const currentSettings = AUTH_SETTINGS[CURRENT_BLOG_PATH] || AUTH_SETTINGS.default;

        // 2. èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã§ä½¿ç”¨ã™ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä»£å…¥
        const CORRECT_PASSWORD_1 = currentSettings.password1; 
        const CORRECT_PASSWORD_2 = currentSettings.password2;

        // 1. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼IDã®ç”Ÿæˆã¨æ°¸ç¶šåŒ– (ã‚³ãƒ¡ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼ç”¨)
        function getPlayerId() {
            let playerId = localStorage.getItem('arg_player_id');
            if (!playerId) {
                playerId = 'player-' + Math.random().toString(36).substring(2, 9);
                localStorage.setItem('arg_player_id', playerId);
            }
            return playerId;
        }

        getPlayerId(); 

        // é›£èª­åŒ–
        function decodeBase64(encodedString) {
            // JavaScriptæ¨™æº–ã®atobé–¢æ•°ã‚’ä½¿ç”¨
            return atob(encodedString); 
        }


        // 2. æ±ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ (2æ®µéšèªè¨¼)
        function authenticate() {
            document.body.classList.add('is-locked');
            // ãƒ•ã‚©ãƒ¼ãƒ ã®HTMLã‚’å®šç¾©
            const formHtml = `
                <div id="auth-overlay" style="display: flex;">
                    <div id="auth-container">
                        <h2>éå…¬é–‹ã‚¨ãƒªã‚¢</h2>
                        
                        <form id="password-form" onsubmit="handleAuthSubmit(event)">
                            <p>${currentSettings.question1}</p>
                            <input type="${currentSettings.inputType1}" id="auth-input-1" placeholder="--${currentSettings.placeholder1}" required>
                            <br>
                            <p>${currentSettings.question2}</p>
                            <input type="${currentSettings.inputType2}" id="auth-input-2" placeholder="--${currentSettings.placeholder2}" required>
                            
                            <button type="submit" id="auth-submit-button">ãƒ­ã‚°ã‚¤ãƒ³</button>
                        </form>
                        
                        <p id="auth-message" style="display: none;">å›ç­”ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚</p>
                        
                        <p style="margin-top: 20px; text-align: center;"><a href="${BASE_URL}/${CURRENT_BLOG_PATH}" style="color: #666;">[ ãƒ–ãƒ­ã‚°å…¥å£ã«æˆ»ã‚‹ ]</a></p>
                    </div>
                </div>
            `;

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ body ã®å…ˆé ­ã«æŒ¿å…¥ (afterbegin)
            const headerElement = document.querySelector('header');
            if (headerElement) {
                headerElement.insertAdjacentHTML('afterend', formHtml);
            } else {
                // header ãŒè¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã° body ã®å…ˆé ­ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                document.body.insertAdjacentHTML('afterbegin', formHtml);
            }
            
            // ã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã™ã‚‹ãŸã‚ã€è¦ç´ ãŒå­˜åœ¨ã™ã‚‹å ´åˆã«ã®ã¿ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’è©¦ã¿ã¾ã™
            const input1 = document.getElementById('auth-input-1');
            if (input1) {
                input1.focus(); 
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®å‡¦ç†
        function handleAuthSubmit(event) {
            event.preventDefault(); 
            
            const input1 = document.getElementById('auth-input-1').value.trim();
            const input2 = document.getElementById('auth-input-2').value.trim();
            const errorMessage = document.getElementById('auth-message');

            const decodedPassword1 = decodeBase64(CORRECT_PASSWORD_1);
            const decodedPassword2 = decodeBase64(CORRECT_PASSWORD_2);

            if (input1 === decodedPassword1 && input2 === decodedPassword2) {
                // èªè¨¼æˆåŠŸ
                document.body.classList.remove('is-locked');
                localStorage.setItem(AUTH_FLAG_KEY, 'true');
                const overlay = document.getElementById('auth-overlay');
                if (overlay) { overlay.remove(); }
                
                
                window.location.href = window.location.href; 
            } else {
                // èªè¨¼å¤±æ•—
                errorMessage.style.display = 'block';
                document.getElementById('auth-input-1').value = ''; 
                document.getElementById('auth-input-2').value = ''; 
                document.getElementById('auth-input-1').focus();
            }
        }

        // 3. ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Ÿè¡Œ
        function checkPrivateAccess() {
            const currentPath = window.location.pathname;
            
            // ğŸ”‘ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° PRIVATE_PATH ã‚’ä½¿ç”¨
            const isAuthenticated = localStorage.getItem(AUTH_FLAG_KEY) === 'true';
            const isPrivateArea = currentPath.startsWith(PRIVATE_PATH); 


            // éå…¬é–‹ã‚¨ãƒªã‚¢ã‹ã¤æœªèªè¨¼ã®å ´åˆ
            if (isPrivateArea && !isAuthenticated) {
                
                authenticate(); // ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
                const mainContent = document.querySelector('.main-container');
                
            } else {
                // èªè¨¼æ¸ˆã¿ã¾ãŸã¯å…¬é–‹ã‚¨ãƒªã‚¢ã®å ´åˆ
                document.body.style.display = 'block'; 
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œ
        checkPrivateAccess();

    </script>

</body>
</html>