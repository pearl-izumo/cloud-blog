<div class="posts-list">
    <h1>{{ page.title }}</h1>
    
    {% comment %} 
        page.status_to_show が正しく設定されない問題を回避するため、
        ページURLから現在のリストが公開リストか非公開リストかを判定する。
        例: /private/index.html 
    {% endcomment %}
    {% assign is_private_list = page.url | split: '/' | join: ' ' | contains: 'private' %}

    <ul>
        {% for post in site.posts reversed %}
            
            {% comment %} 🔑 フィルタリングの核: リスト種別と記事statusを比較 {% endcomment %}

            {% comment %} (1) 隠し記事は常に除外 {% endcomment %}
            {% if post.exclude_from_list %}
                {% continue %}
            {% endif %}

            {% comment %} (2) 記事が公開(public)の場合 {% endcomment %}
            {% if post.status == 'public' %}
                {% comment %} 公開リスト、非公開リストどちらでも表示する（非公開エリアで公開記事を見せるため） {% endcomment %}
                {% assign should_display = true %}
            
            {% comment %} (3) 記事が非公開(private)の場合 {% endcomment %}
            {% elsif post.status == 'private' %}
                {% comment %} 現在のページが非公開リストページでのみ表示 {% endcomment %}
                {% if is_private_list %}
                    {% assign should_display = true %}
                {% else %}
                    {% assign should_display = false %}
                {% endif %}
            
            {% else %}
                {% assign should_display = false %}
            {% endif %}

            {% if should_display %}
                <li>
                    <a href="{{ site.baseurl }}{{ post.url }}">
                        {{ post.title }}
                    </a>
                    <small>({{ post.date | date: "%Y-%m-%d" }})</small>
                </li>
            {% endif %}
            
        {% endfor %}
    </ul>
</div>


