<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title | default: site.blog_title }}</title>
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/style.css">
</head>
<body>

    <header>
        <div class="header-content">
            <a href="{{ site.baseurl }}/" class="logo-link">
                <img src="{{ site.baseurl }}/assets/cloudblog_logo.png" alt="CLOUDBLOGãƒ­ã‚´" class="header-logo">
            </a>
        </div>
    </header>

    <div class="main-container">
        {{ content }}
    </div>

    <footer>
        <p class="footer-note">
            ã“ã®Webã‚µã‚¤ãƒˆã®å†…å®¹ã¯ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€<br>
            å®Ÿåœ¨ã®äººç‰©ãƒ»å›£ä½“ã¨ã¯ä¸€åˆ‡é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚
        </p>
        <p class="footer-copyright">&copy; å‡ºé›²ï¼ˆ@pearl_izumoï¼‰</p>
    </footer>

    <script>
        // ğŸ”‘ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å®šç¾©: Liquidå¤‰æ•°ã®å®‰å…¨ãªå‚ç…§
        const BASE_URL = "{{ site.baseurl | default: '' }}"; 
        const CURRENT_BLOG_PATH = "{{ page.blog_path | default: 'amaneblog' }}"; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚‚è¨­å®š
        const PRIVATE_PATH = BASE_URL + "/" + CURRENT_BLOG_PATH + "/private/";
        const AUTH_FLAG_KEY = `isAuthenticated_${CURRENT_BLOG_PATH}`;

        let CORRECT_PASSWORD_1;
        let CORRECT_PASSWORD_2;

        if (CURRENT_BLOG_PATH === 'amaneblog') {
            // amaneblog ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
            CORRECT_PASSWORD_1 = "0324"; // â† ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰1
            CORRECT_PASSWORD_2 = "feelspecial"; // â† ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰2
        } else if (CURRENT_BLOG_PATH === 'hokanoblog') {
            // hokanoblog ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
            CORRECT_PASSWORD_1 = "1st"; // â† ç•°ãªã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰1
            CORRECT_PASSWORD_2 = "2nd"; // â† ç•°ãªã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰2
        } else {
            // ä¸æ˜ãªãƒ–ãƒ­ã‚°ã®å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ/å®‰å…¨ãªå€¤
            CORRECT_PASSWORD_1 = "DEFAULT_1";
            CORRECT_PASSWORD_2 = "DEFAULT_2";
        }

        // 1. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼IDã®ç”Ÿæˆã¨æ°¸ç¶šåŒ– (ã‚³ãƒ¡ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼ç”¨)
        function getPlayerId() {
            let playerId = localStorage.getItem('arg_player_id');
            if (!playerId) {
                playerId = 'player-' + Math.random().toString(36).substring(2, 9);
                localStorage.setItem('arg_player_id', playerId);
            }
            return playerId;
        }

        getPlayerId(); 


        // 2. æ±ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ (2æ®µéšèªè¨¼)
        function authenticate() {
            // ãƒ•ã‚©ãƒ¼ãƒ ã®HTMLã‚’å®šç¾©
            const formHtml = `
                <div id="auth-overlay" style="
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0, 0, 0, 0.9); z-index: 10000; 
                    display: flex; 
                    justify-content: center; align-items: center; 
                    flex-direction: column; color: white;
                ">
                    <h2>ã€äºŒé‡èªè¨¼ãŒå¿…è¦ã§ã™ã€‘</h2>
                    <p>éå…¬é–‹ã‚¨ãƒªã‚¢ã¸å…¥ã‚‹ãŸã‚ã® **åˆè¨€è‘‰** ã¨ **ç§˜å¯†ã®æ•°å­—** ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                    <form id="password-form" onsubmit="handleAuthSubmit(event)">
                        <input type="text" id="auth-input-1" placeholder="åˆè¨€è‘‰ (ä¾‹: AMANE-SECRET-KEY)" style="padding: 8px; margin: 5px; width: 250px;">
                        <input type="text" id="auth-input-2" placeholder="ç§˜å¯†ã®æ•°å­— (ä¾‹: CLOUD-HIDDEN-WORD)" style="padding: 8px; margin: 5px; width: 250px;">
                        <button type="submit" style="padding: 8px 15px; margin-top: 10px;">èªè¨¼ã‚’è©¦ã¿ã‚‹</button>
                    </form>
                    <p style="margin-top: 20px;"><a href="${BASE_URL}/" style="color: #ccc;">[ ãƒ–ãƒ­ã‚°å…¥å£ã«æˆ»ã‚‹ ]</a></p>
                    <p id="error-message" style="color: red; margin-top: 10px; display: none;">åˆè¨€è‘‰ã¾ãŸã¯ç§˜å¯†ã®æ•°å­—ãŒé•ã„ã¾ã™ã€‚</p>
                </div>
            `;

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ body ã®å…ˆé ­ã«æŒ¿å…¥ (afterbegin)
            document.body.insertAdjacentHTML('afterbegin', formHtml);
            
            // ã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã™ã‚‹ãŸã‚ã€è¦ç´ ãŒå­˜åœ¨ã™ã‚‹å ´åˆã«ã®ã¿ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’è©¦ã¿ã¾ã™
            const input1 = document.getElementById('auth-input-1');
            if (input1) {
                 input1.focus(); 
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®å‡¦ç†
        function handleAuthSubmit(event) {
            event.preventDefault(); 
            
            const input1 = document.getElementById('auth-input-1').value.trim();
            const input2 = document.getElementById('auth-input-2').value.trim();
            const errorMessage = document.getElementById('error-message');

            if (input1 === CORRECT_PASSWORD_1 && input2 === CORRECT_PASSWORD_2) {
                // èªè¨¼æˆåŠŸ
                localStorage.setItem(AUTH_FLAG_KEY, 'true');
                const overlay = document.getElementById('auth-overlay');
                if (overlay) { overlay.remove(); }
                
                window.location.href = window.location.href; 
            } else {
                // èªè¨¼å¤±æ•—
                errorMessage.style.display = 'block';
                document.getElementById('auth-input-1').value = ''; 
                document.getElementById('auth-input-2').value = ''; 
                document.getElementById('auth-input-1').focus();
            }
        }

        // 3. ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Ÿè¡Œ
        function checkPrivateAccess() {
            const currentPath = window.location.pathname;
            
            // ğŸ”‘ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° PRIVATE_PATH ã‚’ä½¿ç”¨
            const isAuthenticated = localStorage.getItem(AUTH_FLAG_KEY) === 'true';
            const isPrivateArea = currentPath.startsWith(PRIVATE_PATH); 

            // éå…¬é–‹ã‚¨ãƒªã‚¢ã‹ã¤æœªèªè¨¼ã®å ´åˆ
            if (isPrivateArea && !isAuthenticated) {
                
                authenticate(); // ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º

                // ä¿®æ­£æ¸ˆã¿: bodyã®æ§‹æˆè¦ç´ ã‚’å€‹åˆ¥ã«éè¡¨ç¤ºã«ã™ã‚‹
                document.body.style.display = 'block'; 
                
                const elementsToHide = ['header', '.container', 'footer'];
                elementsToHide.forEach(selector => {
                    const element = document.querySelector(selector);
                    if (element) {
                        element.style.display = 'none';
                    }
                });
                
            } else {
                // èªè¨¼æ¸ˆã¿ã¾ãŸã¯å…¬é–‹ã‚¨ãƒªã‚¢ã®å ´åˆ
                document.body.style.display = 'block'; 
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œ
        checkPrivateAccess();

    </script>

</body>
</html>